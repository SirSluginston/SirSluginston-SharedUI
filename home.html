<!--
  SharedUI Demo Home (was index.html)
  - Modular, reusable, and future-proof (like a slug in a suit)
  - All content and branding injected/configured via JS and projects.json
  - If you break this, you owe SirSluginston a coffee
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <script>
    // Set window.sharedUIBase dynamically based on current script location
    (function() {
      var scripts = document.getElementsByTagName('script');
      var thisScript = scripts[scripts.length - 1];
      var path = thisScript.src || window.location.pathname;
      var base = path.split('/').slice(0, -1).join('/') + '/';
      // If running from root, base is './', else keep as is
      if (base.endsWith('/')) base = base;
      window.sharedUIBase = base.includes('SharedUI') ? base.split('SharedUI')[0] + 'SharedUI/' : './SharedUI/';
    })();
    // Insert ?project=sharedui in the URL if missing, without reloading
    (function() {
      var params = new URLSearchParams(window.location.search);
      if (!params.has('project')) {
        params.set('project', 'sharedui');
        var newUrl = window.location.pathname + '?' + params.toString();
        window.history.replaceState({}, '', newUrl);
      }
    })();
</script>
<script>
  // Wait for all SharedUI scripts to be loaded, then run main UI injection
  function sharedUIReady(cb) {
    // Wait for all required globals
    var check = function() {
      if (window.SharedUILib && window.SharedUILib.getProjects && window.injectHeader && window.injectFooter) {
        cb();
      } else {
        setTimeout(check, 30);
      }
    };
    check();
  }
  sharedUIReady(function() {
    (async function() {
      const { getProjects, injectHeader, injectFooter, applyBranding } = window.SharedUILib;
      // Always use the SharedUI config (slug: 'sharedui')
      const projects = await getProjects();
      const config = projects.find(p => (p.slug && p.slug.toLowerCase() === 'sharedui')) || projects[0];
      window.SharedUIConfig = config;
      if (applyBranding) applyBranding(config);
      if (injectHeader) injectHeader(config);
      if (injectFooter) injectFooter(config);
      // Re-inject navbar after SharedUIConfig is set
      if (window.fetch && document.getElementById('site-navbar')) {
        const base = (typeof window.sharedUIBase === 'function') ? window.sharedUIBase() : (window.sharedUIBase || './SharedUI/');
        fetch(base + 'Navbar/navbar.html')
          .then(response => response.text())
          .then(html => {
            document.getElementById('site-navbar').innerHTML = html;
            if (window.SharedUIConfig && Array.isArray(SharedUIConfig.navbarLinks)) {
              var ul = document.querySelector('.shared-navbar-list');
              ul.innerHTML = '';
              SharedUIConfig.navbarLinks.forEach(function(link) {
                var li = document.createElement('li');
                // Dropdown support
                if (link.dropdown && Array.isArray(link.dropdown)) {
                  li.classList.add('sharedui-dropdown');
                  var trigger = document.createElement('span');
                  trigger.className = 'sharedui-dropdown-trigger';
                  trigger.textContent = link.text;
                  trigger.setAttribute('tabindex', '0');
                  li.appendChild(trigger);
                  var dropdownContent = document.createElement('div');
                  dropdownContent.className = 'sharedui-dropdown-content';
                  link.dropdown.forEach(function(item) {
                    var dropA = document.createElement('a');
                    // Support pageKey in dropdowns
                    if (item.pageKey && Array.isArray(SharedUIConfig.pages)) {
                      var page = SharedUIConfig.pages.find(p => p.key === item.pageKey);
                      if (page) {
                        let baseHref = page.href;
                        if (baseHref && !baseHref.endsWith('.html')) baseHref += '.html';
                        if (/^(\.\/)?(home|projects|assets|about|index)(\.html)?$/i.test(baseHref)) {
                          baseHref = baseHref.replace(/^\.\//, '');
                          if (!baseHref.endsWith('.html')) baseHref += '.html';
                          baseHref = '/' + baseHref;
                        } else if (!baseHref.startsWith('./') && !baseHref.startsWith('/')) {
                          baseHref = './' + baseHref;
                        }
                        let sep = baseHref.includes('?') ? '&' : '?';
                        dropA.href = baseHref + sep + 'project=' + encodeURIComponent(SharedUIConfig.slug);
                        dropA.textContent = page.pageTitle || page.key;
                      } else {
                        dropA.href = '#';
                        dropA.textContent = item.pageKey;
                      }
                    } else {
                      dropA.href = item.href || '#';
                      dropA.textContent = item.text;
                    }
                    dropdownContent.appendChild(dropA);
                  });
                  li.appendChild(dropdownContent);
                } else if (link.pageKey && Array.isArray(SharedUIConfig.pages)) {
                  var page = SharedUIConfig.pages.find(p => p.key === link.pageKey);
                  if (page) {
                    let baseHref = page.href;
                    if (baseHref && !baseHref.endsWith('.html')) baseHref += '.html';
                    if (/^(\.\/)?(home|projects|assets|about|index)(\.html)?$/i.test(baseHref)) {
                      baseHref = baseHref.replace(/^\.\//, '');
                      if (!baseHref.endsWith('.html')) baseHref += '.html';
                      baseHref = '/' + baseHref;
                    } else if (!baseHref.startsWith('./') && !baseHref.startsWith('/')) {
                      baseHref = './' + baseHref;
                    }
                    let sep = baseHref.includes('?') ? '&' : '?';
                    var a = document.createElement('a');
                    a.href = baseHref + sep + 'project=' + encodeURIComponent(SharedUIConfig.slug);
                    a.textContent = page.pageTitle || page.key;
                    li.appendChild(a);
                  } else {
                    var a = document.createElement('a');
                    a.href = '#';
                    a.textContent = link.pageKey;
                    li.appendChild(a);
                  }
                } else {
                  var a = document.createElement('a');
                  a.href = link.href || '#';
                  a.textContent = link.text;
                  li.appendChild(a);
                }
                ul.appendChild(li);
              });
            }
            if (window.SharedUIDropdown) SharedUIDropdown.initAll();
          });
      }
      // Set hero content from config
      var heroContainer = document.getElementById('shared-hero-container');
      var pageHref = window.location.pathname.split('/').pop() || 'home.html';
      // Normalize to ensure .html extension is present for matching
      var normPageHref = pageHref.endsWith('.html') ? pageHref.toLowerCase() : (pageHref + '.html').toLowerCase();
      var pageConfig = (config.pages || []).find(p => {
        if (!p.href) return false;
        var normHref = p.href.toLowerCase();
        return normHref === normPageHref || normHref.replace('.html','') === pageHref.toLowerCase().replace('.html','');
      });
      if (window.SharedUIHero && heroContainer && pageConfig) {
        SharedUIHero.inject(heroContainer, pageConfig.pageTitle, pageConfig.pageTagline);
      }
    })();
  });
</script>
  <!-- SharedUI core styles and config: don't touch unless you like chaos -->
  <link rel="stylesheet" href="SharedUI-border.css">
  <link rel="stylesheet" href="variables.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home | SirSluginston SharedUI</title>
  <!-- SharedUI component styles: use dynamic base path -->
  <link rel="stylesheet" href="" id="header-css">
  <link rel="stylesheet" href="" id="navbar-css">
  <link rel="stylesheet" href="" id="body-css">
  <link rel="stylesheet" href="" id="footer-css">
  <link rel="stylesheet" href="" id="theme-toggle-css">
  <link rel="stylesheet" href="" id="dropdown-css">
  <link rel="stylesheet" href="" id="modals-css">
  <link rel="stylesheet" href="" id="hero-css">
</head>
<body>
  <div class="sharedui-outer-border">
    <!-- SharedUI Header: top hat required -->
    <div id="header-container"></div>
    <!-- SharedUI Navbar: navigation for the truly lost -->
    <div id="site-navbar"></div>
    <!-- SharedUI Hero: page title and tagline (full width) -->
    <div id="shared-hero-container"></div>
    <!-- SharedUI Body: where the magic (and content) happens -->
    <div id="body-container">
      <div class="shared-body">
        <div class="body-content" id="shared-body-content"></div>
      </div>
    </div>
    <!-- SharedUI Footer: the end, but also the beginning -->
  <div id="footer-container"></div>
  </div>
    <!-- SharedUI JS: config must be loaded first, use dynamic base path -->
    <script>
      // Set all SharedUI CSS paths dynamically
      window.addEventListener('DOMContentLoaded', function() {
        var base = window.sharedUIBase || './SharedUI/';
        document.getElementById('header-css').href = base + 'Header/header.css';
        document.getElementById('navbar-css').href = base + 'Navbar/navbar.css';
        document.getElementById('body-css').href = base + 'Body/body.css';
        document.getElementById('footer-css').href = base + 'Footer/footer.css';
        document.getElementById('theme-toggle-css').href = base + 'ThemeToggle/theme-toggle.css';
        document.getElementById('dropdown-css').href = base + 'Dropdown/dropdown.css';
        document.getElementById('modals-css').href = base + 'Modals/modal.css';
        document.getElementById('hero-css').href = base + 'Hero/hero.css';
      });
    </script>
    <script src="config.js"></script>
    <script>
      // Dynamically load SharedUI scripts using base path
      var base = window.sharedUIBase || './SharedUI/';
      function loadScript(src, cb) {
        var s = document.createElement('script');
        s.src = src;
        s.onload = cb || null;
        document.body.appendChild(s);
      }
      console.log('[SharedUI] Loading sharedui.js');
      loadScript(base + 'sharedui.js', function() {
        console.log('[SharedUI] Loading ThemeToggle/theme-toggle.js');
        loadScript(base + 'ThemeToggle/theme-toggle.js');
        console.log('[SharedUI] Loading Header/header.js');
        loadScript(base + 'Header/header.js');
        console.log('[SharedUI] Loading Dropdown/dropdown.js');
        loadScript(base + 'Dropdown/dropdown.js');
        console.log('[SharedUI] Loading Modals/modal.js');
        loadScript(base + 'Modals/modal.js');
        console.log('[SharedUI] Loading Hero/hero.js');
        loadScript(base + 'Hero/hero.js');
        console.log('[SharedUI] Loading Navbar/navbar.js');
        loadScript(base + 'Navbar/navbar.js', function() {
          if (window.SharedUIDropdown) SharedUIDropdown.initAll();
          if (window.SharedUIModal) SharedUIModal.initAll();
        });
      });
    </script>
</body>
</html>
